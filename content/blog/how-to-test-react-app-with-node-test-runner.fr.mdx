---
title: Comment tester une application React avec Node Test Runner
description: Simplifiez et acc√©l√©rez drastiquement les tests de votre application React en passant √† Node Test Runner.
date: 2024-12-10
authors: AugustinMauroy
---

## Introduction

Les tests sont une partie cruciale du d√©veloppement logiciel, garantissant que votre application se comporte comme pr√©vu. Avec le [Node.js Test Runner](https://nodejs.org/en/learn/test-runner/introduction), vous pouvez int√©grer facilement les tests dans votre application [React](https://react.dev). Ce guide vous accompagnera dans le processus de configuration et d'ex√©cution des tests pour une application React en utilisant le Node.js Test Runner.

> Je vous recommande vivement de lire les [guides du Node.js Test Runner](https://nodejs.org/en/learn/test-runner/introduction) pour comprendre comment fonctionne le test runner de Node.js.
> Ce guide suppose que vous avez une compr√©hension de base de React et des tests.

## Installation des D√©pendances

Tout d'abord, vous devez installer les d√©pendances n√©cessaires. En plus des d√©pendances de votre application React, vous aurez besoin des √©l√©ments suivants :

```bash
npm add --save-dev @testing-library/react @testing-library/dom jsdom global-jsdom
```

> **Note** : Les autres d√©pendances que nous utiliserons proviennent de Node.js.

## √âcriture du Composant √† Tester

Cr√©ons un composant React simple que nous allons tester. Ce composant sera un compteur qui incr√©mente une valeur lorsque l'on clique sur un bouton.

```tsx fileName="src/components/Counter/index.tsx"
'use client';
import { useState } from 'react';
import styles from './index.module.css';
import type { FC } from 'react';

const Counter: FC = () => {
  const [count, setCount] = useState(0);

  return (
    <div className={styles.container}>
      <p className={styles.count}>{count}</p>
      <button onClick={() => setCount(count + 1)} className={styles.button}>
        Increment
      </button>
    </div>
  );
};

export default Counter;
```

<details>
  <summary>`index.module.css`</summary>

  ```css fileName="src/components/Counter/index.module.css"
  .container {
    @apply flex flex-col items-center justify-center;

    .count {
      @apply text-4xl;
    }

    .button {
      @apply px-4 py-2 bg-blue-500 text-white rounded-md;
    }
  }
  ```
</details>

## Enregistrement des Chargeurs Node.js

Pour g√©rer TypeScript et les modules CSS, vous devez enregistrer les chargeurs appropri√©s. Cr√©ez un fichier nomm√© `node-hooks/react-test.js` et ajoutez le code suivant :

> Pour comprendre ce qu'est un chargeur, consultez [cet article](/blog/post/how-to-use-nodejs-loader).

Vous devrez enregistrer les chargeurs pour TypeScript et les modules CSS :

Tout d'abord, installons les chargeurs en temps que d√©pendances de d√©veloppement :

```bash
npm add -D @nodejs-loaders/tsx @nodejs-loaders/css-module
```

Ensuite, cr√©ez le fichier d'enregistrement :

```mjs fileName="node-hooks/react-test.js"
import { register } from 'node:module';
import jsdom from 'global-jsdom';

// Enregistrer les chargeurs
register('@nodejs-loaders/tsx', import.meta.url);
register('@nodejs-loaders/css-module', import.meta.url);

jsdom(undefined, {
  // ‚ö†Ô∏è Ne pas sp√©cifier cela entra√Ænera probablement de nombreux ü§¨
  url: 'https://test.example.com',
});
```

> **Vous pouvez avoir besoin d'utiliser `@nodejs-loaders/alias` pour permettre √† Node.js de comprendre les alias de chemin dans vos fichiers TypeScript.

## √âcriture du Test

Maintenant, √©crivons un test pour le composant `Counter`. Cr√©ez un fichier nomm√© `index.test.tsx` dans le m√™me r√©pertoire que votre composant :

```tsx fileName="src/components/Counter/index.test.tsx"
import assert from 'node:assert/strict';
import { describe, it } from 'node:test';
import { render, fireEvent, screen } from '@testing-library/react';
import Counter from './index.ts'; // ‚ö†Ô∏è Nous devons importer le fichier avec l'extension .ts

describe('Counter', () => {
  it('should increment the count when the button is clicked', () => {
    const { unmount } = render(<Counter />);

    const button = screen.getByRole('button', { name: /increment/i });
    const count = screen.getByText('0');

    assert.strictEqual(count.textContent, '0');

    fireEvent.click(button);

    assert.strictEqual(count.textContent, '1');

    // ‚ö†Ô∏è Il est bon de d√©monter le composant pour √©viter qu'il ne se propage dans le DOM d'autres tests
    unmount();
  });
});
```

### Structure d'un Fichier de Test

Une structure typique de fichier de test inclut :

1. **Imports** : Importez les modules et composants n√©cessaires.
2. **Suite de Tests** : D√©finissez une suite de tests en utilisant `describe`.
3. **Cas de Test** : D√©finissez des cas de test individuels en utilisant `it`.
4. **Rendu du Composant** : Rendez le composant √† tester.
5. **Actions** : Simulez les interactions utilisateur ou d'autres actions.
6. **Assertions** : Faites des assertions pour v√©rifier le comportement attendu.
7. **D√©montage du Composant** : Nettoyez en d√©montant le composant.

## Ex√©cution du Test

Pour ex√©cuter le test, utilisez la commande suivante :

```bash
node --test --import="./node-hooks/typescript.js" --import="./node-hooks/react.js" **/*.test.tsx
```

Vous pouvez √©galement ajouter un script √† votre `package.json` pour simplifier l'ex√©cution des tests :

```json fileName="package.json"
{
  "scripts": {
    "test:unit": "node --test --import=\"./node-hooks/typescript.js\" --import=\"./node-hooks/react.js\" **/*.test.tsx",
    "test:watch": "node --run test:unit --watch"
  }
}
```

> **Note** : Vous pouvez ajouter plus de motifs au mod√®le de glob pour tester plus de fichiers. Par exemple, `**/*.test.ts` pour tester tous les fichiers TypeScript.

Et ensuite pour appeler le script, vous pouvez utiliser `--run` :

```bash
node --run test:unit # ou node --run test:watch
```

## Conclusion

Tester votre application React avec le Node.js Test Runner est un processus simple. En suivant les √©tapes d√©crites dans ce guide, vous pouvez vous assurer que vos composants se comportent comme pr√©vu. Bon test !
